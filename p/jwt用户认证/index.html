<!doctype html><html lang=zh-CN dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼ ç”¨æˆ·è®¤è¯ httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œä¸€æ¬¡è¯·æ±‚ç»“æŸåï¼Œä¸‹æ¬¡åœ¨å‘é€æœåŠ¡å™¨å°±ä¸çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯è°å‘æ¥çš„äº†ï¼ˆåŒä¸€ä¸ªIPä¸ä»£è¡¨åŒä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œåœ¨webåº”ç”¨ä¸­ï¼Œç”¨æˆ·çš„è®¤çŸ¥å’Œé‰´æƒæ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå®è·µä¸­æœ‰å¤šç§èƒ½ç”¨æ–¹æ¡ˆ\n"><title>JWTç”¨æˆ·è®¤è¯</title><link rel=canonical href=https://yuxiay.github.io/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/><link rel=stylesheet href=/scss/style.min.946cca6c6259ef94ac55abfae7c7bf3291ea3ed5eea17ef77500b257217c6710.css><meta property='og:title' content="JWTç”¨æˆ·è®¤è¯"><meta property='og:description' content="åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼ ç”¨æˆ·è®¤è¯ httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œä¸€æ¬¡è¯·æ±‚ç»“æŸåï¼Œä¸‹æ¬¡åœ¨å‘é€æœåŠ¡å™¨å°±ä¸çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯è°å‘æ¥çš„äº†ï¼ˆåŒä¸€ä¸ªIPä¸ä»£è¡¨åŒä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œåœ¨webåº”ç”¨ä¸­ï¼Œç”¨æˆ·çš„è®¤çŸ¥å’Œé‰´æƒæ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå®è·µä¸­æœ‰å¤šç§èƒ½ç”¨æ–¹æ¡ˆ\n"><meta property='og:url' content='https://yuxiay.github.io/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/'><meta property='og:site_name' content='yuxiayçš„åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-11-20T19:07:26+08:00'><meta property='article:modified_time' content='2024-11-20T19:07:26+08:00'><meta name=twitter:title content="JWTç”¨æˆ·è®¤è¯"><meta name=twitter:description content="åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼ ç”¨æˆ·è®¤è¯ httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œä¸€æ¬¡è¯·æ±‚ç»“æŸåï¼Œä¸‹æ¬¡åœ¨å‘é€æœåŠ¡å™¨å°±ä¸çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯è°å‘æ¥çš„äº†ï¼ˆåŒä¸€ä¸ªIPä¸ä»£è¡¨åŒä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œåœ¨webåº”ç”¨ä¸­ï¼Œç”¨æˆ·çš„è®¤çŸ¥å’Œé‰´æƒæ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå®è·µä¸­æœ‰å¤šç§èƒ½ç”¨æ–¹æ¡ˆ\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_b33ac33d040797db.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥</span></figure><div class=site-meta><h1 class=site-name><a href=/>yuxiayçš„åšå®¢</a></h1><h2 class=site-description>å·å¾—æµ®ç”ŸåŠæ—¥é—²</h2></div></header><ol class=menu-social><li><a href=https://github.com target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://twitter.com target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼>åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼</a><ol><li><a href=#ç”¨æˆ·è®¤è¯>ç”¨æˆ·è®¤è¯</a></li><li><a href=#cookie-sessionè®¤è¯æ¨¡å¼>Cookie-sessionè®¤è¯æ¨¡å¼</a></li><li><a href=#tokenè®¤è¯æ¨¡å¼>Tokenè®¤è¯æ¨¡å¼</a></li></ol></li><li><a href=#jwtä»‹ç»>JWTä»‹ç»</a><ol><li><a href=#header>Header</a></li><li><a href=#payload>Payload</a></li><li><a href=#signature>Signature</a></li><li><a href=#jwtä¼˜ç¼ºç‚¹>JWTä¼˜ç¼ºç‚¹</a></li><li><a href=#åœ¨é¡¹ç›®ä¸­ä½¿ç”¨jwt>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨JWT</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/>JWTç”¨æˆ·è®¤è¯</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Nov 20, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h2 id=åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼>åŸºäºcookie-sessionå’Œtokençš„è®¤è¯æ¨¡å¼</h2><h3 id=ç”¨æˆ·è®¤è¯>ç”¨æˆ·è®¤è¯</h3><p>httpæ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„åè®®ï¼Œä¸€æ¬¡è¯·æ±‚ç»“æŸåï¼Œä¸‹æ¬¡åœ¨å‘é€æœåŠ¡å™¨å°±ä¸çŸ¥é“è¿™ä¸ªè¯·æ±‚æ˜¯è°å‘æ¥çš„äº†ï¼ˆåŒä¸€ä¸ªIPä¸ä»£è¡¨åŒä¸€ä¸ªç”¨æˆ·ï¼‰ï¼Œåœ¨webåº”ç”¨ä¸­ï¼Œç”¨æˆ·çš„è®¤çŸ¥å’Œé‰´æƒæ˜¯éå¸¸é‡è¦çš„ä¸€ç¯ï¼Œå®è·µä¸­æœ‰å¤šç§èƒ½ç”¨æ–¹æ¡ˆ</p><h3 id=cookie-sessionè®¤è¯æ¨¡å¼>Cookie-sessionè®¤è¯æ¨¡å¼</h3><p>åœ¨webåº”ç”¨å‘å±•åˆæœŸï¼Œå¤§éƒ¨åˆ†é‡‡ç”¨åŸºäºCookie-Sessionçš„ä¼šè¯ç®¡ç†æ–¹å¼ï¼Œé€»è¾‘å¦‚ä¸‹</p><ul><li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åï¼Œå¯†ç è¿›è¡Œè®¤è¯</li><li>æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·åï¼Œå¯†ç æ­£ç¡®åç”Ÿæˆå¹¶å­˜å‚¨Sessionï¼Œå°†SessionIDé€šè¿‡Cookieè¿”å›ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯è®¿é—®éœ€è¦è®¤è¯çš„æ¥å£æ—¶åœ¨Cookieä¸­æºå¸¦SessionID</li><li>æœåŠ¡å™¨é€šè¿‡SessionIDæŸ¥æ‰¾Sessionå¹¶è¿›è¡Œé‰´æƒï¼Œè¿”å›ç»™å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®</li></ul><p>åŸºäºsessionçš„æ–¹å¼å­˜åœ¨å¤šç§é—®é¢˜</p><ul><li>æœåŠ¡å™¨éœ€è¦å­˜å‚¨sessionï¼Œå¹¶ä¸”ç”±äºsessionéœ€è¦ç»å¸¸å¿«é€ŸæŸ¥æ‰¾ï¼Œé€šå¸¸å­˜å‚¨åœ¨å†…å­˜æˆ–å†…å­˜æ•°æ®åº“ä¸­ï¼ŒåŒæ—¶åœ¨çº¿ç”¨æˆ·è¾ƒå¤šæ—¶éœ€è¦å ç”¨å¤§é‡çš„æœåŠ¡å™¨èµ„æº</li><li>å½“éœ€è¦æ‰©å±•æ—¶ï¼Œåˆ›å»ºsessionçš„æœåŠ¡å™¨å¯èƒ½ä¸æ˜¯éªŒè¯sessionçš„æœåŠ¡å™¨ï¼Œæ‰€ä»¥è¿˜è¦å°†æ‰€æœ‰çš„sessionå•ç‹¬å­˜å‚¨å…±äº«</li><li>ç”±äºå®¢æˆ·ç«¯ä½¿ç”¨cookieå­˜å‚¨sessionIDï¼Œåœ¨è·¨åœºæ™¯ä¸‹éœ€è¦è¿›è¡Œå…¼å®¹æ€§å¤„ç†ï¼ŒåŒæ—¶è¿™ç§æ–¹å¼ä¹Ÿéš¾ä»¥é˜²èŒƒCSRFæ”»å‡»</li></ul><h3 id=tokenè®¤è¯æ¨¡å¼>Tokenè®¤è¯æ¨¡å¼</h3><p>é‰´äºåŸºäºsessionçš„ä¼šè¯ç®¡ç†æ–¹å¼å­˜åœ¨ä¸Šè¿°å¤šä¸ªç¼ºç‚¹ï¼ŒåŸºäºTokençš„æ— çŠ¶æ€ä¼šè¯ç®¡ç†æ–¹å¼è¯ç”Ÿäº†ï¼Œæ‰€è°“æ— çŠ¶æ€ï¼Œå°±æ˜¯æœåŠ¡å™¨å¯ä»¥ä¸å†å­˜å‚¨ä¿¡æ¯ï¼Œç”šè‡³æ˜¯ä¸å†å­˜å‚¨sessionï¼Œé€»è¾‘å¦‚ä¸‹</p><ul><li>å®¢æˆ·ç«¯ä½¿ç”¨ç”¨æˆ·åï¼Œå¯†ç è¿›è¡Œè®¤è¯</li><li>æœåŠ¡ç«¯éªŒè¯ç”¨æˆ·åï¼Œå¯†ç æ­£ç¡®åç”Ÿæˆtokenè¿”å›å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯ä¿å­˜tokenï¼Œè®¿é—®éœ€è¦è®¤è¯çš„æ¥å£åœ¨URLå‚æ•°æˆ–HTTP Headerä¸­åŠ å…¥Token</li><li>æœåŠ¡å™¨é€šè¿‡è§£ç Tokenè¿›è¡Œé‰´æƒï¼Œè¿”å›ç»™å®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®</li></ul><p>åŸºäºTokenä¼šè¯ç®¡ç†æ–¹å¼æœ‰æ•ˆè§£å†³äº†åŸºäºSessionçš„ä¼šè¯ç®¡ç†æ–¹å¼å¸¦æ¥çš„é—®é¢˜</p><ul><li>æœåŠ¡ç«¯ä¸éœ€è¦å­˜å‚¨å’Œç”¨æˆ·é‰´æƒæœ‰å…³çš„ä¿¡æ¯ï¼Œé‰´æƒä¿¡æ¯ä¼šè¢«åŠ å¯†åˆ°Tokenä¸­ï¼ŒæœåŠ¡ç«¯åªéœ€è¦è¯»å–Tokenä¸­åŒ…å«çš„é‰´æƒä¿¡æ¯å³å¯</li><li>é¿å…äº†å…±äº«Sessionå¯¼è‡´çš„ä¸æ˜“æ‰©å±•é—®é¢˜</li><li>ä¸éœ€è¦ä¾èµ–Cookieï¼Œæœ‰æ•ˆé¿å…Cookieå¸¦æ¥çš„CSRFæ”»å‡»é—®é¢˜</li><li>ä½¿ç”¨CORSå¯ä»¥å¿«é€Ÿè§£å†³è·¨åŸŸé—®é¢˜</li></ul><h2 id=jwtä»‹ç»>JWTä»‹ç»</h2><p>JWTæ—¶JSON Web Tokençš„ç¼©å†™ï¼Œæœ¬èº«æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ã€‚JWTæœ¬èº«æ²¡æœ‰å®šä¹‰ä»»ä½•æŠ€æœ¯å®ç°ï¼Œå®ƒåªæ˜¯å®šä¹‰äº†ä¸€ç§åŸºäºTokençš„ä¼šè¯ç®¡ç†çš„è§„åˆ™ï¼Œæ¶µç›–äº†Tokenéœ€è¦åŒ…å«çš„æ ‡å‡†å†…å®¹å’ŒTokençš„ç”Ÿæˆè¿‡ç¨‹ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»é™†ï¼ˆSSOï¼‰åœºæ™¯</p><p>ä¸€ä¸ªJWT Tokenæ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆ</p><ul><li>å¤´éƒ¨ï¼ˆHEADERï¼‰</li><li>è´Ÿè½½ (PAYLOAD)</li><li>ç­¾å (SIGNATURE)</li></ul><p>å¤´éƒ¨å’Œè´Ÿè½½ä»¥JSONå½¢å¼å­˜åœ¨ï¼Œè¿™å°±æ˜¯JWTä¸­çš„JSONï¼Œä¸‰éƒ¨åˆ†çš„å†…å®¹éƒ½åˆ†åˆ«å•ç‹¬ç»è¿‡äº†Base64ç¼©ç ï¼Œä»¥. æ‹¼æ¥æˆä¸€ä¸ªJWT Token</p><h3 id=header>Header</h3><p>JWTçš„Headerä¸­å­˜å‚¨äº†æ‰€ä½¿ç”¨çš„åŠ å¯†ç®—æ³•å’ŒTokenç±»å‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>	
</span></span><span class=line><span class=cl>	<span class=nt>&#34;alg&#34;</span><span class=p>:</span> <span class=s2>&#34;HS256&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;typ&#34;</span><span class=p>:</span> <span class=s2>&#34;JWT&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=payload>Payload</h3><p>Payloadè¡¨ç¤ºè´Ÿè½½ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼ŒJWTè§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µä¾›é€‰ç”¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>iss (issuer): ç­¾å‘äºº
</span></span><span class=line><span class=cl>exp (expiratiaon time): è¿‡æœŸæ—¶é—´
</span></span><span class=line><span class=cl>sub (subject): ä¸»é¢˜
</span></span><span class=line><span class=cl>aud (audience): å—ä¼—
</span></span><span class=line><span class=cl>nbf (Not Before): ç”Ÿæ•ˆæ—¶é—´
</span></span><span class=line><span class=cl>iat (Issued At): ç­¾å‘æ—¶é—´
</span></span><span class=line><span class=cl>jti (JWT ID): ç¼–å·
</span></span></code></pre></td></tr></table></div></div><p>é™¤äº†å®˜æ–¹å­—æ®µï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå·±æŒ‡å®šå­—æ®µå’Œå†…å®¹ï¼Œä¾‹å¦‚ä¸‹é¢å†…å®¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nt>&#34;sub&#34;</span><span class=p>:</span> <span class=s2>&#34;1234567890&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;John Doe&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;admin&#34;</span><span class=p>:</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„ï¼ŒJWTé»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯»åˆ°ï¼Œæ‰€ä»¥ä¸è¦æŠŠç§˜å¯†ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚è¿™ä¸ªJSONå¯¹è±¡ä¹Ÿè¦ä½¿ç”¨Base64URLç®—æ³•è½¬æˆå­—ç¬¦ä¸²</p><h3 id=signature>Signature</h3><p>Signatureéƒ¨åˆ†æ˜¯å¯¹å‰ä¿©ä¸ªéƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹</p><p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ (secret)ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨Headeré‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³• (é»˜è®¤æ˜¯ HMAC SHA256)ï¼ŒæŒ‰ç…§ä¸‹é¢å…¬å¼äº§ç”Ÿç­¾å</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>HMACSHA256</span><span class=p>(</span><span class=n>base64UrlEncode</span><span class=p>(</span><span class=n>header</span><span class=p>)</span> <span class=o>+</span> <span class=s2>&#34;.&#34;</span> <span class=o>+</span> <span class=n>base64UrlEncode</span><span class=p>(</span><span class=n>payload</span><span class=p>),</span> <span class=n>secret</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=jwtä¼˜ç¼ºç‚¹>JWTä¼˜ç¼ºç‚¹</h3><p>JWTæ‹¥æœ‰åŸºäºTokençš„ä¼šè¯ç®¡ç†æ–¹å¼æ‰€æ‹¥æœ‰çš„ä¸€åˆ‡ä¼˜åŠ¿ï¼Œä¸ä¾èµ–Cookieï¼Œä½¿å¾—é˜²æ­¢CSRFæ”»å‡»ï¼Œä¹Ÿèƒ½åœ¨ç¦ç”¨Cookieçš„æµè§ˆå™¨ç¯å¢ƒä¸­æ­£å¸¸è¿è¡Œ</p><p>è€ŒJWTçš„æœ€å¤§ä¼˜åŠ¿æ˜¯æœåŠ¡ç«¯ä¸å†éœ€è¦å­˜å‚¨Sessionï¼Œä½¿å¾—æœåŠ¡ç«¯è®¤è¯é‰´æƒä¸šåŠ¡å¯ä»¥æ–¹ä¾¿æ‰©å±•ï¼Œé¿å…å­˜å‚¨Sessionæ‰€éœ€è¦å¼•å…¥çš„Redisç­‰ç»„ä»¶ï¼Œé™ä½äº†ç³»ç»Ÿæ¶æ„çš„å¤æ‚åº¦ã€‚ä½†è¿™ä¹Ÿæ˜¯JWTæœ€å¤§çš„åŠ£åŠ¿ï¼Œç”±äºæœ‰æ•ˆæœŸå­˜å‚¨åœ¨Tokenä¸­ï¼ŒJWT Tokenä¸€æ—¦ç­¾å‘ï¼Œå°±ä¼šåœ¨æœ‰æ•ˆæœŸå†…ä¸€ç›´å¯ç”¨ï¼Œæ— æ³•åœ¨æœåŠ¡ç«¯åºŸæ­¢ï¼Œå½“ç”¨æˆ·è¿›è¡Œç™»å‡ºæ“ä½œï¼Œåªèƒ½ä¾èµ–å®¢æˆ·ç«¯åˆ é™¤æ‰æœ¬åœ°å­˜å‚¨çš„JWT Tokenï¼Œå¦‚æœéœ€è¦ç¦ç”¨ç”¨æˆ·ï¼Œå•çº¯ä½¿ç”¨JWTå°±æ— æ³•å®ç°</p><h3 id=åœ¨é¡¹ç›®ä¸­ä½¿ç”¨jwt>åœ¨é¡¹ç›®ä¸­ä½¿ç”¨JWT</h3><p>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨jwt-goè¿™ä¸ªåº“æ¥å®ç°æˆ‘ä»¬ç”ŸæˆJWTå’Œè§£æJWTçš„åŠŸèƒ½</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>package</span> <span class=n>jwt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/pkg/errors&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s2>&#34;github.com/golang-jwt/jwt/v4&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>MyClaims</span> <span class=err>è‡ªå®šä¹‰å£°æ˜ç»“æ„ä½“å¹¶å†…åµŒ</span><span class=n>jwt</span><span class=o>.</span><span class=n>StandardClaims</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>jwtåŒ…è‡ªå¸¦çš„jwt</span><span class=o>.</span><span class=n>StandardClaimåªåŒ…å«äº†å®˜æ–¹å­—æ®µ</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=err>æˆ‘ä»¬è¿™é‡Œéœ€è¦é¢å¤–è®°å½•ä¸€ä¸ª</span><span class=n>usernameå­—æ®µ</span><span class=err>ï¼Œæ‰€ä»¥è¦è‡ªå®šä¹‰ç»“æ„ä½“</span>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=err>å¦‚æœæƒ³è¦ä¿å­˜æ›´å¤šä¿¡æ¯ï¼Œéƒ½å¯ä»¥æ·»åŠ åˆ°è¿™ä¸ªç»“æ„ä½“ä¸­</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>const</span> <span class=n>TokenExpireDuration</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>Hour</span> <span class=o>*</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>var</span> <span class=n>MySerect</span> <span class=o>=</span> <span class=p>[]</span><span class=n>byte</span><span class=p>(</span><span class=s2>&#34;æœˆäº®æœˆäº®ä½ ä¸æ‡‚ï¼Œå…­ä¾¿å£«åˆ°åº•æœ‰å¤šé‡&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>type</span> <span class=n>MyClaims</span> <span class=n>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>UserID</span>   <span class=n>int64</span>  <span class=err>`</span><span class=n>json</span><span class=p>:</span><span class=s2>&#34;user_id&#34;</span><span class=err>`</span>
</span></span><span class=line><span class=cl>	<span class=n>Username</span> <span class=n>string</span> <span class=err>`</span><span class=n>json</span><span class=p>:</span><span class=s2>&#34;username&#34;</span><span class=err>`</span>
</span></span><span class=line><span class=cl>	<span class=n>jwt</span><span class=o>.</span><span class=n>RegisteredClaims</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>func</span> <span class=n>GenToken</span><span class=p>(</span><span class=n>userID</span> <span class=n>int64</span><span class=p>,</span> <span class=n>username</span> <span class=n>string</span><span class=p>)</span> <span class=p>(</span><span class=n>string</span><span class=p>,</span> <span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span><span class=err>åˆ›å»ºä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å£°æ˜çš„æ•°æ®</span>
</span></span><span class=line><span class=cl>	<span class=n>claims</span> <span class=p>:</span><span class=o>=</span> <span class=n>MyClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=n>userID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=n>username</span><span class=p>,</span> <span class=o>//</span> <span class=err>è‡ªå®šä¹‰å­—æ®µ</span>
</span></span><span class=line><span class=cl>		<span class=n>jwt</span><span class=o>.</span><span class=n>RegisteredClaims</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>ExpiresAt</span><span class=p>:</span> <span class=n>jwt</span><span class=o>.</span><span class=n>NewNumericDate</span><span class=p>(</span><span class=n>time</span><span class=o>.</span><span class=n>Now</span><span class=p>()</span><span class=o>.</span><span class=n>Add</span><span class=p>(</span><span class=n>TokenExpireDuration</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>			<span class=n>Issuer</span><span class=p>:</span>    <span class=s2>&#34;bluebell&#34;</span><span class=p>,</span> <span class=o>//</span> <span class=err>ç­¾å‘äºº</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span> <span class=err>ä½¿ç”¨æŒ‡å®šçš„ç­¾åæ–¹æ³•åˆ›å»ºç­¾åå¯¹è±¡</span>
</span></span><span class=line><span class=cl>	<span class=n>token</span> <span class=p>:</span><span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>NewWithClaims</span><span class=p>(</span><span class=n>jwt</span><span class=o>.</span><span class=n>SigningMethodHS256</span><span class=p>,</span> <span class=n>claims</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span> <span class=err>ä½¿ç”¨æŒ‡å®šçš„</span><span class=n>secretç­¾åå¹¶è·å¾—å®Œæ•´çš„ç¼–ç åçš„å­—ç¬¦ä¸²token</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>token</span><span class=o>.</span><span class=n>SignedString</span><span class=p>(</span><span class=n>MySerect</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>//</span> <span class=n>ParseToken</span> <span class=err>è§£æ</span><span class=n>JWT</span>
</span></span><span class=line><span class=cl><span class=k>func</span> <span class=n>ParseToken</span><span class=p>(</span><span class=n>tokenString</span> <span class=n>string</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=n>MyClaims</span><span class=p>,</span> <span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span> <span class=err>è§£æ</span><span class=n>token</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span> <span class=err>å¦‚æœæ˜¯è‡ªå®šä¹‰</span><span class=n>Claimç»“æ„ä½“åˆ™éœ€è¦ä½¿ç”¨</span> <span class=n>ParseWithClaims</span> <span class=err>æ–¹æ³•</span>
</span></span><span class=line><span class=cl>	<span class=n>token</span><span class=p>,</span> <span class=n>err</span> <span class=p>:</span><span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>ParseWithClaims</span><span class=p>(</span><span class=n>tokenString</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>MyClaims</span><span class=p>{},</span> <span class=k>func</span><span class=p>(</span><span class=n>token</span> <span class=o>*</span><span class=n>jwt</span><span class=o>.</span><span class=n>Token</span><span class=p>)</span> <span class=p>(</span><span class=n>i</span> <span class=n>interface</span><span class=p>{},</span> <span class=n>err</span> <span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=o>//</span> <span class=err>ç›´æ¥ä½¿ç”¨æ ‡å‡†çš„</span><span class=n>Claimåˆ™å¯ä»¥ç›´æ¥ä½¿ç”¨Parseæ–¹æ³•</span>
</span></span><span class=line><span class=cl>		<span class=o>//</span><span class=n>token</span><span class=p>,</span> <span class=n>err</span> <span class=p>:</span><span class=o>=</span> <span class=n>jwt</span><span class=o>.</span><span class=n>Parse</span><span class=p>(</span><span class=n>tokenString</span><span class=p>,</span> <span class=k>func</span><span class=p>(</span><span class=n>token</span> <span class=o>*</span><span class=n>jwt</span><span class=o>.</span><span class=n>Token</span><span class=p>)</span> <span class=p>(</span><span class=n>i</span> <span class=n>interface</span><span class=p>{},</span> <span class=n>err</span> <span class=n>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>MySerect</span><span class=p>,</span> <span class=n>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>err</span> <span class=o>!=</span> <span class=n>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>nil</span><span class=p>,</span> <span class=n>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=o>//</span> <span class=err>å¯¹</span><span class=n>tokenå¯¹è±¡ä¸­çš„Claimè¿›è¡Œç±»å‹æ–­è¨€</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=n>claims</span><span class=p>,</span> <span class=n>ok</span> <span class=p>:</span><span class=o>=</span> <span class=n>token</span><span class=o>.</span><span class=n>Claims</span><span class=o>.</span><span class=p>(</span><span class=o>*</span><span class=n>MyClaims</span><span class=p>);</span> <span class=n>ok</span> <span class=o>&amp;&amp;</span> <span class=n>token</span><span class=o>.</span><span class=n>Valid</span> <span class=p>{</span> <span class=o>//</span> <span class=err>æ ¡éªŒ</span><span class=n>token</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=n>claims</span><span class=p>,</span> <span class=n>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=n>nil</span><span class=p>,</span> <span class=n>errors</span><span class=o>.</span><span class=n>New</span><span class=p>(</span><span class=s2>&#34;invalid token&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>const</span><span class=w> </span><span class=nx>ContextUserIDKey</span><span class=w> </span><span class=p>=</span><span class=w> </span><span class=s>&#34;userID&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c1>// JWTAuthMiddleware åŸºäºJWTçš„è®¤è¯ä¸­é—´ä»¶</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>func</span><span class=w> </span><span class=nf>JWTAuthMiddleware</span><span class=p>()</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=k>return</span><span class=w> </span><span class=kd>func</span><span class=p>(</span><span class=nx>c</span><span class=w> </span><span class=o>*</span><span class=nx>gin</span><span class=p>.</span><span class=nx>Context</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// å®¢æˆ·ç«¯æºå¸¦Tokenæœ‰ä¸‰ç§æ–¹å¼ 1.æ”¾åœ¨è¯·æ±‚å¤´ 2.æ”¾åœ¨è¯·æ±‚ä½“ 3.æ”¾åœ¨URI</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// è¿™é‡Œå‡è®¾Tokenæ”¾åœ¨Headerçš„Authorizationä¸­ï¼Œå¹¶ä½¿ç”¨Bearerå¼€å¤´</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// Authorization: Bearer xxx.xxx.xx		/ X-TOKEN: xxx.xxx.xx</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// è¿™é‡Œçš„å…·ä½“å®ç°æ–¹å¼è¦ä¾æ®ä½ çš„å®é™…ä¸šåŠ¡æƒ…å†µå†³å®š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>authHeader</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>c</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>Header</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=s>&#34;Authorization&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=nx>authHeader</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;&#34;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>controller</span><span class=p>.</span><span class=nf>ResponseError</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span><span class=w> </span><span class=nx>controller</span><span class=p>.</span><span class=nx>CodeNeedLogin</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=cp>//Goè¯­è¨€çš„Ginæ¡†æ¶ä¸­ï¼Œc.Abort()æ˜¯ä¸€ä¸ªç”¨äºä¸­æ–­è¯·æ±‚å¤„ç†é“¾çš„æ–¹æ³•ã€‚</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=cp>//å½“ä½ åœ¨ä¸­é—´ä»¶æˆ–å¤„ç†å‡½æ•°ä¸­è°ƒç”¨c.Abort()æ—¶ï¼Œå®ƒä¼šé˜»æ­¢åç»­çš„ä¸­é—´ä»¶æˆ–å¤„ç†å™¨è¢«è°ƒç”¨ï¼Œä½†æ˜¯å®ƒä¸ä¼šåœæ­¢å½“å‰å¤„ç†ç¨‹åºçš„æ‰§è¡Œ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=cp>//è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨è°ƒç”¨c.Abort()ä¹‹åè¿˜æœ‰å…¶ä»–ä»£ç ï¼Œè¿™äº›ä»£ç ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œé™¤éè·Ÿéšä¸€ä¸ªreturnè¯­å¥æ¥ç«‹å³é€€å‡ºå½“å‰å‡½æ•°</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// æŒ‰ç©ºæ ¼åˆ†å‰²</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>parts</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>strings</span><span class=p>.</span><span class=nf>SplitN</span><span class=p>(</span><span class=nx>authHeader</span><span class=p>,</span><span class=w> </span><span class=s>&#34; &#34;</span><span class=p>,</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=p>!(</span><span class=nb>len</span><span class=p>(</span><span class=nx>parts</span><span class=p>)</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>&amp;&amp;</span><span class=w> </span><span class=nx>parts</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=s>&#34;Bearer&#34;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>controller</span><span class=p>.</span><span class=nf>ResponseError</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span><span class=w> </span><span class=nx>controller</span><span class=p>.</span><span class=nx>CodeInvalidAuth</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=cp>//ç¬¬äºŒç§æ–¹å¼å¯ç”¨ç›´æ¥ä»è¿™é‡Œå¼€å§‹ï¼Œå°†å‰é¢è°ƒæ•´å–X-Token</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// parts[1]æ˜¯è·å–åˆ°çš„tokenStringï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å®šä¹‰å¥½çš„è§£æJWTçš„å‡½æ•°æ¥è§£æå®ƒ</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>mc</span><span class=p>,</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=nx>jwt</span><span class=p>.</span><span class=nf>ParseToken</span><span class=p>(</span><span class=nx>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=k>if</span><span class=w> </span><span class=nx>err</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=kc>nil</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>controller</span><span class=p>.</span><span class=nf>ResponseError</span><span class=p>(</span><span class=nx>c</span><span class=p>,</span><span class=w> </span><span class=nx>controller</span><span class=p>.</span><span class=nx>CodeInvalidAuth</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=nx>c</span><span class=p>.</span><span class=nf>Abort</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>			</span><span class=k>return</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=c1>// å°†å½“å‰è¯·æ±‚çš„userIDä¿¡æ¯ä¿å­˜åˆ°è¯·æ±‚çš„ä¸Šä¸‹æ–‡cä¸Š</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>c</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=nx>ContextUserIDKey</span><span class=p>,</span><span class=w> </span><span class=nx>mc</span><span class=p>.</span><span class=nx>UserID</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>		</span><span class=nx>c</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span><span class=w> </span><span class=c1>// åç»­çš„å¤„ç†å‡½æ•°å¯ä»¥ç”¨è¿‡c.Get(ContextUserIDKey)æ¥è·å–å½“å‰è¯·æ±‚çš„ç”¨æˆ·ä¿¡æ¯</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>	</span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p><img src=/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152557109.png width=847 height=906 srcset="/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152557109_hu_a91cbfc501d18bbb.png 480w, /p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152557109_hu_4bbad47729740ecc.png 1024w" loading=lazy alt=image-20250417152557109 class=gallery-image data-flex-grow=93 data-flex-basis=224px></p><p><img src=/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152957655.png width=1056 height=648 srcset="/p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152957655_hu_16cf46616a5de618.png 480w, /p/jwt%E7%94%A8%E6%88%B7%E8%AE%A4%E8%AF%81/image-20250417152957655_hu_749e08beaf99c31a.png 1024w" loading=lazy alt=image-20250417152957655 class=gallery-image data-flex-grow=162 data-flex-basis=391px></p></section><footer class=article-footer><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 yuxiayçš„åšå®¢</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>